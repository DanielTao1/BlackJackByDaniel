<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>ğŸ’è±ªå21ç‚¹ğŸ’µ-æ‰‹æœºç‰ˆ</title>
	<style>
		/* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
		body {
			font-family: 'Arial', sans-serif;
			background: #1a1a1a;
			color: #fff;
			margin: 0;
			padding: 10px;
			min-height: 100vh;
		}
		.container {
			display: flex;
			flex-direction: column;
			margin: 10px 0;
		}
		.auth-box {
			position: fixed;
			top: 40%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: #2a2a2a;
			width: 90%;
			max-width: 300px;
			padding: 15px;
			border-radius: 10px;
			z-index: 1000;
		}
		.game-area {
			width: 100%;
			background: #2a2a2a;
			padding: 15px;
			border-radius: 10px;
			margin: 10px 0;
			box-sizing: border-box;
		}
		.bet-buttons {
			display: grid;
			grid-template-columns: repeat(2, 1fr);
			gap: 8px;
			margin: 10px 0;
		}
		.bet-buttons button {
			padding: 12px 8px;
			font-size: 14px;
			background: #4CAF50;
			border: none;
			color: white;
			border-radius: 8px;
			cursor: pointer;
			white-space: nowrap;
		}
		input {
			padding: 10px;
			margin: 5px;
			width: 100%;
			box-sizing: border-box;
			background: #333;
			border: 1px solid #444;
			color: white;
			border-radius: 8px;
		}
		.cards {
			min-height: 80px;
			padding: 10px;
			background: #333;
			border-radius: 8px;
			margin: 8px 0;
		}
		.leaderboard {
			width: 100%;
			background: #2a2a2a;
			padding: 15px;
			border-radius: 10px;
			margin: 10px 0;
			box-sizing: border-box;
		}
		.money {
			color: #FFD700;
			font-size: 20px;
			margin: 15px 0;
		}
		.card-symbol {
			margin: 3px;
			padding: 6px;
			background: #444;
			border-radius: 5px;
			display: inline-block;
			font-size: 14px;
		}
		.level-info {
			color: #4CAF50;
			font-size: 16px;
			margin: 10px 0;
		}
		.progress-bar {
			width: 80%;
			height: 8px;
			background: #333;
			border-radius: 5px;
			margin: 5px auto;
		}
		.progress {
			height: 100%;
			background: #4CAF50;
			border-radius: 5px;
			transition: width 0.3s;
		}
		.ad-container {
			position: fixed;
			bottom: 70px;
			left: 50%;
			transform: translateX(-50%);
			width: 90%;
			max-width: 400px;
			padding: 10px;
			background: rgba(51, 51, 51, 0.9);
			border-radius: 8px;
			z-index: 1000;
		}
		#ad-button {
			width: 100%;
			padding: 12px;
			background: #FF5722;
			border: none;
			color: white;
			border-radius: 6px;
			cursor: pointer;
			font-size: 14px;
		}
		.redeem-box {
			position: fixed;
			bottom: 140px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(51, 51, 51, 0.9);
			padding: 10px;
			border-radius: 8px;
			z-index: 1000;
			width: 90%;
			max-width: 400px;
			text-align: center;
		}
		#game-controls button {
			padding: 15px 20px;
			margin: 5px;
			font-size: 16px;
			flex: 1;
			min-width: 45%;
			border-radius: 8px;
		}
		.double-button {
			background: #FF9800 !important;
		}
		button {
			touch-action: manipulation;
			user-select: none;
			-webkit-tap-highlight-color: transparent;
		}
		h1 { font-size: 24px; margin: 10px 0; }
		h2 { font-size: 20px; }
		h3 { font-size: 18px; margin: 8px 0; }
		.sidebet-options {
			margin: 10px 0;
			padding: 10px;
			background: #333;
			border-radius: 8px;
		}
		.sidebet-options label {
			display: block;
			margin: 8px 0;
			font-size: 14px;
		}
		.sidebet-options input[type="checkbox"] {
			width: auto;
			margin-right: 5px;
		}
		@media (min-width: 768px) {
			.bet-buttons { grid-template-columns: repeat(3, 1fr); }
			#game-controls button { min-width: 30%; }
		}
	</style>
</head>
<body>
	<!-- ç™»å½•æ¡† -->
	<div class="auth-box" id="auth-box">
		<h2>ç”¨æˆ·ç™»å½•/æ³¨å†Œ</h2>
		<input type="text" id="username" placeholder="ç”¨æˆ·å">
		<input type="password" id="password" placeholder="å¯†ç ">
		<button onclick="login()">ç™»å½•</button>
		<button onclick="register()">æ³¨å†Œ</button>
	</div>

	<!-- æ¸¸æˆä¸»ç•Œé¢ -->
	<div class="container" id="game-container" style="display: none;">
		<div class="game-area">
			<h1>ğŸ’°å¯Œè±ªç‰ˆ21ç‚¹ğŸ’</h1>
			<div class="level-info">
				ğŸ‘‘ç­‰çº§ï¼š<span id="current-level">1</span>
				<div>ğŸ›¡ï¸ç»éªŒï¼š<span id="current-exp">0</span></div>
				<div class="progress-bar">
					<div class="progress" id="level-progress" style="width: 0%"></div>
				</div>
			</div>
			<div class="money">å½“å‰èµ„é‡‘ğŸ’°ï¼šÂ¥<span id="current-money">0</span></div>
			
			<!-- ä¾§è¾¹æ³¨é€‰é¡¹ -->
			<div class="sidebet-options">
				<label>
					<input type="checkbox" id="flush-check">
					åŒæ—¶æŠ¼åŒèŠ±/é¡ºå­ (1:50ï¼Œä¸»æ³¨5%)
				</label>
				<label>
					<input type="checkbox" id="three-check">
					åŒæ—¶æŠ¼ä¸‰åŒæ•°å­— (1:100ï¼Œä¸»æ³¨5%)
				</label>
			</div>

			<!-- ä¸‹æ³¨æŒ‰é’® -->
			<div class="bet-buttons">
				<button onclick="placeBet(5000)">æŠ¼ Â¥5,000ğŸª™</button>
				<button onclick="placeBet(10000)">æŠ¼ Â¥10,000ğŸª™</button>
				<button onclick="placeBet(50000)">æŠ¼ Â¥50,000ğŸ’¶</button>
				<button onclick="placeBet(100000)">æŠ¼ Â¥100,000ğŸ’¶</button>
				<button onclick="placeBet(300000)">æŠ¼ Â¥300,000ğŸ’¸</button>
				<button onclick="placeBet(500000)">æŠ¼ Â¥500,000ğŸ’¸</button>
				<button onclick="placeBet(1000000)">æŠ¼ Â¥1,000,000ğŸ’µ</button>
				<button onclick="placeBet(5000000)">æŠ¼ Â¥5,000,000ğŸ’µ</button>
				<button onclick="placeBet(10000000)">æŠ¼ Â¥10,000,000ğŸ’³</button>
				<button onclick="placeBet(100000000)">æŠ¼ Â¥100,000,000ğŸ’³</button>

<button onclick="placeBet(500000000)">æŠ¼ Â¥500,000,000ğŸ’°</button>

<button onclick="placeBet(1000000000)">æŠ¼ Â¥1,000,000,000ğŸ’°</button>

			</div>

			<!-- æ¸¸æˆæ§åˆ¶ -->
			<div id="game-controls" style="display: none;">
				<div class="cards">
					<h3>åº„å®¶çš„ç‰Œ (<span id="dealer-score">0</span>)</h3>
					<div id="dealer-cards"></div>
				</div>
				<div class="cards">
					<h3>ä½ çš„ç‰Œ (<span id="player-score">0</span>)</h3>
					<div id="player-cards"></div>
				</div>
				<button onclick="hit()">è¦ç‰Œ</button>
				<button class="double-button" onclick="doubleDown()">DOUBLE åŠ å€</button>
				<button onclick="stand()">åœç‰Œ</button>
				<button onclick="resetGame()">é‡æ–°å¼€å§‹</button>
				<div id="game-result" style="color: #FF5722; font-size: 24px; margin: 15px;"></div>
			</div>
		</div>

		<!-- æ’è¡Œæ¦œ -->
		<div class="leaderboard">
			<h2>ğŸ† å¯Œè±ªæ’è¡Œæ¦œ</h2>
			<ul id="leaderboard-list"></ul>
		</div>
	</div>

	<!-- å¹¿å‘Š -->
	<div class="ad-container">
		<button id="ad-button" onclick="watchAd()">ğŸ¥ çœ‹è§†é¢‘å¾—1ä¸‡é‡‘å¸ğŸ’µ</button>
		<div id="ad-status"></div>
	</div>

	<!-- å…‘æ¢ç  -->
	<div class="redeem-box">
		<input type="text" id="redeem-code" placeholder="è¾“å…¥å…‘æ¢ç ">
		<button onclick="redeemCode()">å…‘æ¢</button>
	</div>

	<script>
		// ç³»ç»Ÿé…ç½®
		const levelRequirements = [0, 10, 50, 300, 1000, 5000, 20000, 50000, 100000,500000,1000000,2000000,5000000,10000000,20000000,50000000,100000000,300000000,500000000,999999999];
		const typeNameMap = {
			flush_straight: 'åŒèŠ±/é¡ºå­',
			threeOfAKind: 'ä¸‰åŒæ•°å­—'
		};

		// æ¸¸æˆæ•°æ®
		let users = JSON.parse(localStorage.getItem('blackjackUsers')) || [];
		let currentUser = null;
		let deck = [];
		let dealerHand = [];
		let playerHand = [];
		let currentBet = 0;
		let gameActive = false;
		let initialCards = [];

		// ä¾§è¾¹æ³¨é…ç½®
		let sideBets = {
			flush_straight: {
				amount: 0,
				odds: 50,
				check: function(cards) {
					return checkFlush(cards) || checkStraight(cards);
				}
			},
			threeOfAKind: {
				amount: 0,
				odds: 100,
				check: checkThreeOfAKind
			}
		};

		// ç”¨æˆ·ç®¡ç†
		function login() {
			const username = document.getElementById('username').value;
			const password = document.getElementById('password').value;
			const user = users.find(u => u.username === username);
			if (user && user.password === password) {
				currentUser = user;
				startGameSession();
			} else {
				alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
			}
		}

		function register() {
			const username = document.getElementById('username').value;
			const password = document.getElementById('password').value;
			if (users.some(u => u.username === username)) {
				alert('ç”¨æˆ·åå·²å­˜åœ¨');
				return;
			}
			const newUser = {
				username,
				password,
				money: 100000,
				adLastUsed: 0,
				level: 1,
				exp: 0,
				totalExp: 0
			};
			users.push(newUser);
			localStorage.setItem('blackjackUsers', JSON.stringify(users));
			currentUser = newUser;
			startGameSession();
		}

		// æ¸¸æˆæ ¸å¿ƒé€»è¾‘
		function initializeDeck() {
			deck = [];
			const suits = ['â™ ', 'â™£', 'â™¥', 'â™¦'];
			const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
			for (let suit of suits) {
				for (let value of values) {
					deck.push({ 
						suit, 
						value, 
						color: (suit === 'â™¥' || suit === 'â™¦') ? 'red' : 'white' 
					});
				}
			}
			for (let i = deck.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[deck[i], deck[j]] = [deck[j], deck[i]];
			}
		}

		function calculateScore(hand) {
			let score = 0;
			let aceCount = 0;
			for (let card of hand) {
				if (card.value === 'A') {
					aceCount++;
					score += 11;
				} else if (['J', 'Q', 'K'].includes(card.value)) {
					score += 10;
				} else {
					score += parseInt(card.value);
				}
			}
			while (score > 21 && aceCount > 0) {
				score -= 10;
				aceCount--;
			}
			return score;
		}

		function dealCard(hand) {
			if (deck.length < 10) initializeDeck();
			return hand.push(deck.pop());
		}

		// ä¿®æ”¹åçš„ä¸‹æ³¨é€»è¾‘
		function placeBet(amount) {
			if (!currentUser) return;
			if (gameActive) {
				alert('è¯·å…ˆç»“æŸå½“å‰æ¸¸æˆå†ä¸‹æ³¨ï¼');
				return;
			}
			
			// è·å–ä¾§è¾¹æ³¨é€‰é¡¹
			const flushBet = document.getElementById('flush-check').checked;
			const threeBet = document.getElementById('three-check').checked;
			
			// è®¡ç®—æ€»ä¸‹æ³¨é‡‘é¢
			let totalBet = amount;
			if (flushBet) totalBet += amount * 0.05;
			if (threeBet) totalBet += amount * 0.05;
			
			if (currentUser.money < totalBet) {
				alert('èµ„é‡‘ä¸è¶³ï¼');
				return;
			}
			
			// æ‰£é™¤é‡‘é¢
			currentUser.money -= totalBet;
			currentBet = amount;
			
			// è®¾ç½®ä¾§è¾¹æ³¨
			sideBets.flush_straight.amount = flushBet ? amount * 0.05 : 0;
			sideBets.threeOfAKind.amount = threeBet ? amount * 0.05 : 0;
			
			// åˆå§‹åŒ–æ¸¸æˆ
			initializeDeck();
			dealerHand = [];
			playerHand = [];
			dealCard(dealerHand);
			dealCard(playerHand);
			dealCard(playerHand);
			initialCards = [...playerHand, dealerHand[0]];
			gameActive = true;
			document.getElementById('game-controls').style.display = 'block';
			updateDisplay();
		}

		// å…¶ä»–æ¸¸æˆåŠŸèƒ½ä¿æŒä¸å˜
		function hit() {
			if (!gameActive) return;
			dealCard(playerHand);
			const playerScore = calculateScore(playerHand);
			updateDisplay();
			if (playerScore > 21) {
				endGame('çˆ†ç‰Œï¼åº„å®¶è·èƒœ');
			}
		}

		function stand() {
			if (!gameActive) return;
			while (calculateScore(dealerHand) < 17) {
				dealCard(dealerHand);
			}
			const dealerScore = calculateScore(dealerHand);
			const playerScore = calculateScore(playerHand);
			
			let result = '';
			if (playerScore > 21) {
				result = 'ç©å®¶çˆ†ç‰Œï¼Œåº„å®¶èµ¢ï¼';
			} else if (dealerScore > 21) {
				result = 'åº„å®¶çˆ†ç‰Œï¼Œç©å®¶èµ¢ï¼';
				currentUser.money += currentBet * 2;
			} else if (playerScore > dealerScore) {
				result = 'ç©å®¶èµ¢ï¼';
				currentUser.money += currentBet * 2;
			} else if (playerScore === dealerScore) {
				result = 'å¹³å±€ï¼';
				currentUser.money += currentBet;
			} else {
				result = 'åº„å®¶èµ¢ï¼';
			}
			endGame(result);
		}

		function endGame(message) {
			gameActive = false;
			checkSideBets();
			updateDisplay();
			
			if (message.includes('èµ¢')) {
				const winAmount = currentBet + Object.values(sideBets)
					.reduce((total, bet) => total + (bet.amount * bet.odds), 0);
				addExperience(winAmount);
			}
			
			document.getElementById('game-result').textContent = message;
			updateMoneyDisplay();
			updateLeaderboard();
			saveUserData();
		}

		// ä¾§è¾¹æ³¨æ£€æŸ¥é€»è¾‘
		function checkSideBets() {
			const checkCards = initialCards;
			for (let type in sideBets) {
				const bet = sideBets[type];
				if (bet.amount > 0 && bet.check(checkCards)) {
					const winnings = bet.amount * bet.odds;
					currentUser.money += winnings + bet.amount;
					alert(`${typeNameMap[type]} ä¸­å¥–ï¼\nä¸‹æ³¨é‡‘é¢ï¼šÂ¥${bet.amount.toLocaleString()}\nè·å¾—å¥–é‡‘ï¼šÂ¥${winnings.toLocaleString()}\næ€»è¿”è¿˜ï¼šÂ¥${(winnings + bet.amount).toLocaleString()}`);
				}
				bet.amount = 0;
			}
		}

		// å…¶ä»–è¾…åŠ©å‡½æ•°ä¿æŒä¸å˜
		function checkFlush(cards) {
			return cards.length >= 3 && cards.every(c => c.suit === cards[0].suit);
		}

		function checkStraight(cards) {
			if (cards.length < 3) return false;
			const values = cards.map(c => {
				switch(c.value) {
					case 'A': return 14;
					case 'K': return 13;
					case 'Q': return 12;
					case 'J': return 11;
					default: return parseInt(c.value);
				}
			}).sort((a, b) => a - b);
			if (values.includes(14) && values.includes(2) && values.includes(3)) return true;
			return (values[2] - values[1] === 1 && values[1] - values[0] === 1);
		}

		function checkThreeOfAKind(cards) {
			return cards.length >= 3 && cards.every(c => c.value === cards[0].value);
		}

		// å…¶ä»–åŠŸèƒ½å‡½æ•°ä¿æŒä¸å˜
		function resetGame() {
			gameActive = false;
			currentBet = 0;
			dealerHand = [];
			playerHand = [];
			document.getElementById('game-controls').style.display = 'none';
			document.getElementById('game-result').textContent = '';
			updateDisplay();
		}

		function doubleDown() {
			if (!gameActive || currentBet === 0) return;
			if (currentUser.money < currentBet) {
				alert('èµ„é‡‘ä¸è¶³ï¼Œæ— æ³•åŠ å€ï¼');
				return;
			}
			currentUser.money -= currentBet;
			currentBet *= 2;
			updateMoneyDisplay();
			dealCard(playerHand);
			updateDisplay();
			stand();
		}

		// ç»éªŒç³»ç»Ÿ
		function addExperience(amount) {
			const expGain = Math.floor(amount / 1000);
			currentUser.exp += expGain;
			currentUser.totalExp += expGain;
			checkLevelUp();
			updateLevelDisplay();
		}

		function checkLevelUp() {
			while (currentUser.level < levelRequirements.length && 
				   currentUser.totalExp >= levelRequirements[currentUser.level]) {
				const reward = currentUser.level * currentUser.level * 50000;
				currentUser.money += reward;
				currentUser.level++;
				alert(`æ­å–œå‡çº§åˆ°${currentUser.level}çº§ï¼è·å¾—å¥–åŠ±Â¥${reward.toLocaleString()}ï¼`);
			}
			saveUserData();
		}

		// æ˜¾ç¤ºæ›´æ–°
		function updateDisplay() {
			document.getElementById('dealer-cards').innerHTML = dealerHand.map((card, index) => {
				if (index === 0 && gameActive) {
					return '<span class="card-symbol" style="background: #555">ğŸ‚ </span>';
				} else {
					return `<span class="card-symbol" style="color: ${card.color}">${card.value}${card.suit}</span>`;
				}
			}).join('');

			document.getElementById('player-cards').innerHTML = playerHand.map(card => 
				`<span class="card-symbol" style="color: ${card.color}">${card.value}${card.suit}</span>`
			).join('');

			document.getElementById('dealer-score').textContent = gameActive ? 
				calculateScore([dealerHand[0]]) : 
				calculateScore(dealerHand);
			document.getElementById('player-score').textContent = calculateScore(playerHand);
		}

		function updateMoneyDisplay() {
			document.getElementById('current-money').textContent = currentUser.money.toLocaleString('zh-CN');
		}

		function updateLevelDisplay() {
			document.getElementById('current-level').textContent = currentUser.level;
			document.getElementById('current-exp').textContent = currentUser.totalExp;
			
			const currentLevelIndex = currentUser.level;
			const currentReq = levelRequirements[currentLevelIndex] || levelRequirements[levelRequirements.length - 1];
			const prevReq = levelRequirements[currentLevelIndex - 1] || 0;
			
			const progress = currentLevelIndex >= levelRequirements.length ? 100 : 
				((currentUser.totalExp - prevReq) / (currentReq - prevReq)) * 100;
			
			document.getElementById('level-progress').style.width = `${Math.min(100, progress)}%`;
		}

		function saveUserData() {
			localStorage.setItem('blackjackUsers', JSON.stringify(users));
		}

		function updateLeaderboard() {
			const sorted = [...users].sort((a, b) => b.money - a.money).slice(0, 10);
			document.getElementById('leaderboard-list').innerHTML = sorted
				.map((user, index) => `
					<li>${index + 1}. ${user.username} - Â¥${user.money.toLocaleString('zh-CN')}</li>
				`).join('');
		}

		function startGameSession() {
			document.getElementById('auth-box').style.display = 'none';
			document.getElementById('game-container').style.display = 'flex';
			updateMoneyDisplay();
			updateLevelDisplay();
			initializeDeck();
			updateLeaderboard();
		}

		// å¹¿å‘ŠåŠŸèƒ½
		async function watchAd() {
			try {
				document.getElementById('ad-button').disabled = true;
				document.getElementById('ad-status').textContent = "å¹¿å‘ŠåŠ è½½ä¸­...";
				await new Promise(resolve => setTimeout(resolve, 2000));
				document.getElementById('ad-status').textContent = "æ­£åœ¨æ’­æ”¾å¹¿å‘Š...";
				await new Promise(resolve => setTimeout(resolve, 10000));
				currentUser.money += 10000;
				updateMoneyDisplay();
				saveUserData();
				document.getElementById('ad-status').textContent = "âœ“ æˆåŠŸè·å¾—10,000é‡‘å¸ï¼";
			} finally {
				document.getElementById('ad-button').disabled = false;
				setTimeout(() => {
					document.getElementById('ad-status').textContent = "";
				}, 3000);
			}
		}

		// å…‘æ¢ç åŠŸèƒ½
		function redeemCode() {
			const code = document.getElementById('redeem-code').value;
			if (code === "VIP888") {
				if (currentUser) {
					currentUser.money += 100000;
					updateMoneyDisplay();
					saveUserData();
					alert("å…‘æ¢æˆåŠŸï¼è·å¾—10ä¸‡é‡‘å¸ï¼");
				} else {
					alert("è¯·å…ˆç™»å½•ï¼");
				}
			} else {
				alert("æ— æ•ˆçš„å…‘æ¢ç ï¼");
			}
		}

		// åˆå§‹åŒ–
		initializeDeck();
	</script>
</body>
</html>
